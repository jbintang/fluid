function [phi,res] = PoissonADI2P3D(phi,nx,ny,nz,Ap,An,As,Ae,Aw,At,Ab,Q,w)

%% Kalkulasi Metode ADI
% Untuk penghitungan arah sumbu x
for j = 2:ny-1
    for k = 2:nz-1
        RHS1(2:nx-1) = (1-w).*Ap(2:nx-1,j,k).*phi(2:nx-1,j,k)...
            + w.*(-(An(2:nx-1,j,k).*phi(2:nx-1,j+1,k) ...
            + As(2:nx-1,j,k).*phi(2:nx-1,j-1,k)...
            + At(2:nx-1,j,k).*phi(2:nx-1,j,k+1)...
            + Ab(2:nx-1,j,k).*phi(2:nx-1,j,k-1))...
            + Q(2:nx-1,j,k));
        % Penggunaan Algoritma Thomas
        phi(2:nx-1,j,k) = tridiag(w.*Aw(2:nx-1,j,k),Ap(2:nx-1,j,k),w.*Ae(2:nx-1,j,k),RHS1(2:nx-1));
    end
end

% Untuk penghitungan arah sumbu y
for i = 2:nx-1
    for k = 2:nz-1
        RHS2(2:ny-1) = (1-w).*Ap(i,2:ny-1,k).*phi(i,2:ny-1,k)...
            + w.*(-(Ae(i,2:ny-1,k).*phi(i+1,2:ny-1,k) ...
            + Aw(i,2:ny-1,k).*phi(i-1,2:ny-1,k) ...
            + At(i,2:ny-1,k).*phi(i,2:ny-1,k+1)...
            + Ab(i,2:ny-1,k).*phi(i,2:ny-1,k-1))...
            + Q(i,2:ny-1,k));
        % Penggunaan Algoritma Thomas
        phi(i,2:ny-1,k) = tridiag(w.*As(i,2:ny-1,k),Ap(i,2:ny-1,k),w.*An(i,2:ny-1,k),RHS2(2:ny-1));
    end
end

% Untuk penghitungan arah sumbu z
for i = 2:nx-1
    for j = 2:ny-1
        RHS3(2:nz-1) = (1-w).*Ap(i,j,2:nz-1).*phi(i,j,2:nz-1)...
            + w.*(-(Ae(i,j,2:nz-1).*phi(i+1,j,2:nz-1) ...
            + Aw(i,j,2:nz-1).*phi(i-1,j,2:nz-1) ...
            + An(i,j,2:nz-1).*phi(i,j+1,2:nz-1)...
            + As(i,j,2:nz-1).*phi(i,j-1,2:nz-1)) ...
            + Q(i,j,2:nz-1));
        % Penggunaan Algoritma Thomas
        phi(i,j,2:nz-1) = tridiag(w.*Ab(i,j,2:nz-1),Ap(i,j,2:nz-1),w.*At(i,j,2:nz-1),RHS3(2:nz-1));
    end
end

%% Penghitungan Residu
rho(2:nx-1,2:ny-1,2:nz-1) = Q(2:nx-1,2:ny-1,2:nz-1) ...
    - ( Ap(2:nx-1,2:ny-1,2:nz-1).*phi(2:nx-1,2:ny-1,2:nz-1) ...
    + An(2:nx-1,2:ny-1,2:nz-1).*phi(2:nx-1,3:ny,2:nz-1) ...
    + As(2:nx-1,2:ny-1,2:nz-1).*phi(2:nx-1,1:ny-2,2:nz-1) ...
    + Ae(2:nx-1,2:ny-1,2:nz-1).*phi(3:nx,2:ny-1,2:nz-1) ...
    + Aw(2:nx-1,2:ny-1,2:nz-1).*phi(1:nx-2,2:ny-1,2:nz-1) ...
    + At(2:nx-1,2:ny-1,2:nz-1).*phi(2:nx-1,2:ny-1,3:nz) ...
    + Ab(2:nx-1,2:ny-1,2:nz-1).*phi(2:nx-1,2:ny-1,1:nz-2));

res = sqrt(sum(sum(sum(rho.^2)))/sqrt(nx^2 + ny^2 + nz^2));